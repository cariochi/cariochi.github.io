<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>RECORDO ¬∑ CARIOCHI</title>
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>RECORDO | CARIOCHI</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="RECORDO" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Documentation hub for Reflecto, Objecto, Recordo, Expresso" />
<meta property="og:description" content="Documentation hub for Reflecto, Objecto, Recordo, Expresso" />
<link rel="canonical" href="https://cariochi.github.io/projects/recordo/" />
<meta property="og:url" content="https://cariochi.github.io/projects/recordo/" />
<meta property="og:site_name" content="CARIOCHI" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="RECORDO" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Documentation hub for Reflecto, Objecto, Recordo, Expresso","headline":"RECORDO","url":"https://cariochi.github.io/projects/recordo/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/site.css"/>
    <link rel="stylesheet" href="/assets/css/rouge.css">
</head>
<body><header class="site-header">
    <div class="container">
        <a class="brand" href="/">
            <img src="/assets/images/logo.svg" alt="CARIOCHI"/>
<!--            <span>CARIOCHI</span>-->
        </a>

        <input type="checkbox" id="nav-toggle" class="nav-toggle" aria-label="Toggle navigation">

        <label for="nav-toggle" class="menu-toggle">
            <svg class="burger" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" fill="none"/>
            </svg>
            <span class="menu-text">Menu</span>
        </label>

        <nav class="top-nav" aria-label="Projects">
            <ul><li>
                <a href="/projects/reflecto">REFLECTO</a>
                </li><li>
                <a href="/projects/objecto">OBJECTO</a>
                </li><li class="active">
                <a href="/projects/recordo">RECORDO</a>
                </li><li>
                <a href="/projects/spring-data-web-spec">WEB SPEC</a>
                </li><li>
                <a href="/projects/expresso">EXPRESSO</a>
                </li></ul>
        </nav><a class="header-github" href="https://github.com/cariochi/recordo" target="_blank" rel="noopener"><svg viewBox="0 0 16 16" width="20" height="20" aria-hidden="true" fill="currentColor">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
                   0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13
                   -.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66
                   .07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15
                   -.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.59-.16 1.23-.24 1.87-.24
                   .64 0 1.28.08 1.87.24 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12
                   .51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48
                   0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
            </svg><span class="github-text">RECORDO</span>
        </a></div>
</header>
<main class="container">
    <div class="grid">
    <aside class="toc" aria-label="Table of contents">
    <div class="toc-inner">
        <h3>RECORDO</h3>
        <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#introduction">Introduction</a></li>
<li class="toc-entry toc-h1"><a href="#getting-started">Getting Started</a>
<ul>
<li class="toc-entry toc-h2"><a href="#maven-dependencies">Maven Dependencies</a></li>
<li class="toc-entry toc-h2"><a href="#compatibility">Compatibility</a></li>
<li class="toc-entry toc-h2"><a href="#initialize-extension">Initialize Extension</a></li>
<li class="toc-entry toc-h2"><a href="#objectmapper">ObjectMapper</a></li>
<li class="toc-entry toc-h2"><a href="#additional-properties">Additional Properties</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#read-module">Read Module</a>
<ul>
<li class="toc-entry toc-h2"><a href="#annotation-parameters">Annotation Parameters</a></li>
<li class="toc-entry toc-h2"><a href="#approach1--interfacebased-object-factory">Approach¬†1 ‚Äî Interface‚Äëbased Object Factory</a></li>
<li class="toc-entry toc-h2"><a href="#approach2--direct-object-creation">Approach¬†2 ‚Äî Direct Object Creation</a></li>
<li class="toc-entry toc-h2"><a href="#supported-types">Supported Types</a></li>
<li class="toc-entry toc-h2"><a href="#firstrun-behavior">First‚ÄëRun Behavior</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#assertions-module">Assertions Module</a>
<ul>
<li class="toc-entry toc-h2"><a href="#json-assertions-jsonassertion">JSON Assertions (JsonAssertion)</a></li>
<li class="toc-entry toc-h2"><a href="#json-assertions-as-assertj-condition-jsoncondition">JSON Assertions as AssertJ Condition (JsonCondition)</a></li>
<li class="toc-entry toc-h2"><a href="#csv-assertions-csvassertion">CSV Assertions (CsvAssertion)</a></li>
<li class="toc-entry toc-h2"><a href="#first-run--debugging-failures">First Run &amp; Debugging Failures</a></li>
<li class="toc-entry toc-h2"><a href="#recommended-gitignore-additions">Recommended .gitignore additions</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#mockmvc-module">MockMvc Module</a>
<ul>
<li class="toc-entry toc-h2"><a href="#define-the-client-interface">Define the client interface</a></li>
<li class="toc-entry toc-h2"><a href="#create-and-use-the-client">Create and use the client</a></li>
<li class="toc-entry toc-h2"><a href="#return-types">Return types</a></li>
<li class="toc-entry toc-h2"><a href="#request-interceptors">Request interceptors</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#mockserver-module">MockServer Module</a>
<ul>
<li class="toc-entry toc-h2"><a href="#how-it-works-on-test-runs">How it works on test runs</a></li>
<li class="toc-entry toc-h2"><a href="#setup-with-spring">Setup with Spring</a></li>
<li class="toc-entry toc-h2"><a href="#using-recordo-without-spring">Using Recordo without Spring</a></li>
<li class="toc-entry toc-h2"><a href="#openfeign-via-supported-http-clients">OpenFeign (via supported HTTP clients)</a></li>
<li class="toc-entry toc-h2"><a href="#annotation-parameters-1">Annotation Parameters</a></li>
<li class="toc-entry toc-h2"><a href="#examples">Examples</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#license">License</a></li>
</ul>
    </div>
</aside>
    <article class="content">
<!--        <h1>RECORDO</h1>-->
        <h1 id="introduction">Introduction</h1>

<p><strong>Recordo</strong> is a JUnit 5 extension that takes the pain out of dealing with test data and mock interactions. Instead of hard-coding DTOs, JSON strings or HTTP stubs in your tests, Recordo moves these resources into files and generates or records them when they don‚Äôt yet exist. On the first run, if the required files don‚Äôt exist, Recordo generates them (for objects or captured HTTP interactions). You review or adjust these files, and on subsequent runs Recordo loads or replays them as fixtures, making tests deterministic.</p>

<p>Key benefits at a glance:</p>

<ul>
  <li><strong>Read Module</strong> ‚Äì annotate test parameters or fields with <code class="language-plaintext highlighter-rouge">@Read</code> to automatically load JSON, CSV, or ZIP resources into objects. Missing files are generated automatically, ensuring fast deterministic tests.</li>
  <li><strong>Assertions Module</strong> ‚Äì assert JSON or CSV responses with expressive fluent APIs. Compare against expected files, filter fields, or ignore order with clear options.</li>
  <li><strong>MockMvc Module</strong> ‚Äì build declarative HTTP clients for your controllers in tests. Use familiar Spring MVC annotations (<code class="language-plaintext highlighter-rouge">@GetMapping</code>, <code class="language-plaintext highlighter-rouge">@PostMapping</code>, etc.) and Recordo will generate typed clients, handle requests, and record responses.</li>
  <li><strong>MockServer Module</strong> ‚Äì capture and replay HTTP traffic from real clients like <code class="language-plaintext highlighter-rouge">OkHttp</code> or <code class="language-plaintext highlighter-rouge">RestTemplate</code>. Save interactions to JSON files and replay them in tests for stable, reproducible scenarios.</li>
</ul>

<p>Recordo combines these modules into a single coherent testing toolkit. It is especially useful when working with complex DTOs, deeply nested JSON structures, or external HTTP APIs, reducing boilerplate and making tests both <strong>readable</strong> and <strong>maintainable</strong>.</p>

<p>üëâ Source code is available on <a href="https://github.com/cariochi/recordo">GitHub</a>.</p>

<h1 id="getting-started">Getting Started</h1>

<h2 id="maven-dependencies">Maven Dependencies</h2>

<p>Recordo is modular. You can either pull in <strong>all modules</strong> for convenience, or declare <strong>only the ones you need</strong>. This gives you flexibility to keep your build lean.</p>

<h3 id="all-modules">All Modules</h3>

<p>Use the <code class="language-plaintext highlighter-rouge">recordo-all</code> artifact to include everything:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.cariochi.recordo<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>recordo-all<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.9<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h3 id="individual-modules">Individual Modules</h3>

<p>If you want to be explicit and import only what you actually use:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Read Module --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.cariochi.recordo<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>recordo-read<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.9<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- Assertions Module --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.cariochi.recordo<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>recordo-assertions<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.9<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- MockMvc Module --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.cariochi.recordo<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>recordo-spring-mockmvc<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.9<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- MockServer Module --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.cariochi.recordo<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>recordo-mockserver<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.9<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="compatibility">Compatibility</h2>

<ul>
  <li><strong>1.x.x</strong> ‚Äî Java 11+ and Spring 5.x (Spring Boot 2.x)</li>
  <li><strong>2.x.x</strong> ‚Äî Java 17+ and Spring 6.x (Spring Boot 3.x)</li>
</ul>

<p>Note: the modules <code class="language-plaintext highlighter-rouge">recordo-read</code>, <code class="language-plaintext highlighter-rouge">recordo-assertions</code>, and <code class="language-plaintext highlighter-rouge">recordo-mockserver</code> work perfectly in projects <strong>without Spring</strong>. Only <code class="language-plaintext highlighter-rouge">recordo-spring-mockmvc</code> requires a Spring context.</p>

<h2 id="initialize-extension">Initialize Extension</h2>

<p>Register the JUnit 5 extension in tests:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">RecordoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">MyTest</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="objectmapper">ObjectMapper</h2>

<p>Recordo uses Jackson <code class="language-plaintext highlighter-rouge">ObjectMapper</code> for JSON serialization and deserialization. The resolution order is:</p>

<ol>
  <li>If a test class has a field annotated with <code class="language-plaintext highlighter-rouge">@EnableRecordo</code>, that <code class="language-plaintext highlighter-rouge">ObjectMapper</code> instance will be used.</li>
  <li>If no such field is present and you run under Spring, Recordo will look for a single <code class="language-plaintext highlighter-rouge">ObjectMapper</code> bean in the application context.</li>
  <li>If neither is found, a built‚Äëin default mapper is used.</li>
</ol>

<p>You can register multiple mappers and reference them by name in annotations (e.g., <code class="language-plaintext highlighter-rouge">@Read(objectMapper = "customMapper")</code>).</p>

<h2 id="additional-properties">Additional Properties</h2>

<p>You can fine-tune behavior in <code class="language-plaintext highlighter-rouge">recordo.properties</code> on the test classpath:</p>

<p><strong><code class="language-plaintext highlighter-rouge">recordo.resources.root</code></strong>
Overrides the base directory where Recordo <strong>reads</strong> expected files and <strong>writes</strong> generated/recorded ones.
<em>Default:</em> <code class="language-plaintext highlighter-rouge">src/test/resources/</code></p>

<p>Examples:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">recordo.resources.root</span><span class="p">=</span><span class="s">src/it/resources</span>
</code></pre></div></div>
<p><strong><code class="language-plaintext highlighter-rouge">recordo.http.headers.included</code></strong>
Comma‚Äëseparated list of header names that must be included into recordings and used for matching during replay.</p>

<p><strong><code class="language-plaintext highlighter-rouge">recordo.http.headers.sensitive</code></strong>
Comma‚Äëseparated list of <strong>sensitive</strong> headers that should be masked in stored recordings (e.g., <code class="language-plaintext highlighter-rouge">Authorization</code>).</p>

<p>Examples:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">recordo.http.headers.included</span><span class="p">=</span><span class="s">Accept,Content-Type,Authorization</span>
<span class="py">recordo.http.headers.sensitive</span><span class="p">=</span><span class="s">Authorization,Set-Cookie</span>
</code></pre></div></div>

<h1 id="read-module">Read Module</h1>

<p>The Read module lets you source test objects from external files and keep them under version control. If a referenced file is missing on the first run, Recordo generates it with a sensible structure and randomized values; on subsequent runs the same file is read back, keeping your tests deterministic.</p>

<h2 id="annotation-parameters">Annotation Parameters</h2>

<p><code class="language-plaintext highlighter-rouge">@Read</code> supports:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">value</code></strong> ‚Äì resource path (e.g. <code class="language-plaintext highlighter-rouge">/books/book.json</code>).</li>
  <li><strong><code class="language-plaintext highlighter-rouge">objectMapper</code></strong> ‚Äì optional name of an <code class="language-plaintext highlighter-rouge">ObjectMapper</code> bean or test‚Äëclass field to use for (de)serialization.</li>
</ul>

<h2 id="approach1--interfacebased-object-factory">Approach¬†1 ‚Äî Interface‚Äëbased Object Factory</h2>

<p>Declare a factory interface with <code class="language-plaintext highlighter-rouge">@RecordoObjectFactory</code>. Mark factory methods with <code class="language-plaintext highlighter-rouge">@Read</code> to bind them to files. Use <code class="language-plaintext highlighter-rouge">@Modifier</code> methods for fluent tweaks.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RecordoObjectFactory</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">LogRecordFactory</span> <span class="o">{</span>

    <span class="c1">// one object</span>
    <span class="nd">@Read</span><span class="o">(</span><span class="s">"/messages/log.json"</span><span class="o">)</span>
    <span class="nc">LogRecord</span> <span class="nf">logRecord</span><span class="o">();</span>

    <span class="c1">// list of objects</span>
    <span class="nd">@Read</span><span class="o">(</span><span class="s">"/messages/logs.json"</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">LogRecord</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">();</span>

    <span class="c1">// raw bytes (e.g., zip archive)</span>
    <span class="nd">@Read</span><span class="o">(</span><span class="s">"/files/out.zip"</span><span class="o">)</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="nf">archive</span><span class="o">();</span>

    <span class="c1">// fluent modifications</span>
    <span class="nd">@Modifier</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
    <span class="nc">LogRecordFactory</span> <span class="nf">withId</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">);</span>

    <span class="nd">@Modifier</span><span class="o">(</span><span class="s">"responses[0].status"</span><span class="o">)</span>
    <span class="nc">LogRecordFactory</span> <span class="nf">withFirstStatus</span><span class="o">(</span><span class="nc">Status</span> <span class="n">status</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>Usage</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">RecordoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">LogTests</span> <span class="o">{</span>
    
    <span class="nc">LogRecordFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="nc">Recordo</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">LogRecordFactory</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">creates_and_modifies</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">LogRecord</span> <span class="n">base</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">logRecord</span><span class="o">();</span>
        <span class="nc">LogRecord</span> <span class="n">modified</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">withId</span><span class="o">(</span><span class="mi">123</span><span class="o">).</span><span class="na">withFirstStatus</span><span class="o">(</span><span class="nc">Status</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">).</span><span class="na">logRecord</span><span class="o">();</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">zip</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">archive</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="approach2--direct-object-creation">Approach¬†2 ‚Äî Direct Object Creation</h2>

<p>Use <code class="language-plaintext highlighter-rouge">@Read</code> directly on test parameters for quick loading without factories.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">single_object</span><span class="o">(</span><span class="nd">@Read</span><span class="o">(</span><span class="s">"/books/book.json"</span><span class="o">)</span> <span class="nc">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">list_of_objects</span><span class="o">(</span><span class="nd">@Read</span><span class="o">(</span><span class="s">"/books/books.json"</span><span class="o">)</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">as_string</span><span class="o">(</span><span class="nd">@Read</span><span class="o">(</span><span class="s">"/texts/info.txt"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">as_bytes</span><span class="o">(</span><span class="nd">@Read</span><span class="o">(</span><span class="s">"/files/archive.zip"</span><span class="o">)</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
</code></pre></div></div>

<h2 id="supported-types">Supported Types</h2>

<ul>
  <li>POJOs/DTOs via Jackson</li>
  <li><code class="language-plaintext highlighter-rouge">List&lt;T&gt;</code> / arrays</li>
  <li><code class="language-plaintext highlighter-rouge">String</code></li>
  <li><code class="language-plaintext highlighter-rouge">byte[]</code></li>
</ul>

<h2 id="firstrun-behavior">First‚ÄëRun Behavior</h2>

<ul>
  <li>If the target file does not exist, Recordo <strong>creates</strong> it with a generated example that matches the return type.</li>
  <li>You may edit the file to your needs; subsequent runs <strong>read</strong> it as a fixture.</li>
</ul>

<blockquote>
  <p>Tip: prefer small, focused files per test scenario; this keeps diffs readable and reviewable.</p>
</blockquote>

<h1 id="assertions-module">Assertions Module</h1>

<p>The Assertions module compares objects and strings against JSON/CSV files using three classes:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">JsonAssertion</code> ‚Äî object ‚áÑ JSON file comparison.</li>
  <li><code class="language-plaintext highlighter-rouge">JsonCondition</code> ‚Äî AssertJ <code class="language-plaintext highlighter-rouge">Condition</code> for object ‚áÑ JSON file comparison.</li>
  <li><code class="language-plaintext highlighter-rouge">CsvAssertion</code> ‚Äî CSV string ‚áÑ CSV file comparison.</li>
</ul>

<h2 id="json-assertions-jsonassertion">JSON Assertions (<code class="language-plaintext highlighter-rouge">JsonAssertion</code>)</h2>

<p>Pass any object (e.g., DTOs, collections, pages). Recordo will serialize it via Jackson and compare with the expected JSON file.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">cariochi</span><span class="o">.</span><span class="na">recordo</span><span class="o">.</span><span class="na">assertions</span><span class="o">.</span><span class="na">JsonAssertion</span><span class="o">.</span><span class="na">assertAsJson</span><span class="o">;</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">shouldMatchBooksShortView</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="n">bookService</span><span class="o">.</span><span class="na">findAllByAuthor</span><span class="o">(</span><span class="n">author</span><span class="o">);</span>

    <span class="n">assertAsJson</span><span class="o">(</span><span class="n">books</span><span class="o">)</span>
        <span class="o">.</span><span class="na">including</span><span class="o">(</span><span class="s">"content[*].id"</span><span class="o">,</span> <span class="s">"content[*].title"</span><span class="o">,</span> <span class="s">"content[*].author.id"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"/books/short_books.json"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="options">Options</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.including(paths...)</code> ‚Äî compare only the listed JSON paths.</li>
  <li><code class="language-plaintext highlighter-rouge">.excluding(paths...)</code> ‚Äî ignore listed paths.</li>
  <li><code class="language-plaintext highlighter-rouge">.extensible(true)</code> ‚Äî allow extra fields.</li>
  <li><code class="language-plaintext highlighter-rouge">.withStrictOrder(true)</code> ‚Äî require array order to match.</li>
  <li><code class="language-plaintext highlighter-rouge">.using(ObjectMapper)</code> ‚Äî custom mapper.</li>
</ul>

<h2 id="json-assertions-as-assertj-condition-jsoncondition">JSON Assertions as AssertJ Condition (<code class="language-plaintext highlighter-rouge">JsonCondition</code>)</h2>

<p><code class="language-plaintext highlighter-rouge">JsonCondition</code> provides an alternative syntax for the same functionality. It supports the same options as <code class="language-plaintext highlighter-rouge">JsonAssertion</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">cariochi</span><span class="o">.</span><span class="na">recordo</span><span class="o">.</span><span class="na">assertions</span><span class="o">.</span><span class="na">JsonCondition</span><span class="o">.</span><span class="na">equalAsJsonTo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">assertj</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">Assertions</span><span class="o">.</span><span class="na">assertThat</span><span class="o">;</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">shouldMatchBooksShortView_withCondition</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="n">bookService</span><span class="o">.</span><span class="na">findAllByAuthor</span><span class="o">(</span><span class="n">author</span><span class="o">);</span>

    <span class="n">assertThat</span><span class="o">(</span><span class="n">books</span><span class="o">)</span>
        <span class="o">.</span><span class="na">is</span><span class="o">(</span><span class="n">equalAsJsonTo</span><span class="o">(</span><span class="s">"/books/short_books.json"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">including</span><span class="o">(</span><span class="s">"content[*].id"</span><span class="o">,</span> <span class="s">"content[*].title"</span><span class="o">,</span> <span class="s">"content[*].author.id"</span><span class="o">)</span>
        <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="csv-assertions-csvassertion">CSV Assertions (<code class="language-plaintext highlighter-rouge">CsvAssertion</code>)</h2>

<p>Compare an <strong>actual CSV string</strong> with an expected CSV file.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">cariochi</span><span class="o">.</span><span class="na">recordo</span><span class="o">.</span><span class="na">assertions</span><span class="o">.</span><span class="na">CsvAssertion</span><span class="o">.</span><span class="na">assertCsv</span><span class="o">;</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">shouldMatchCsv</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">actualCsv</span> <span class="o">=</span> <span class="s">"id,name\n1,John\n"</span><span class="o">;</span>

    <span class="n">assertCsv</span><span class="o">(</span><span class="n">actualCsv</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withHeaders</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withStrictOrder</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withColumnSeparator</span><span class="o">(</span><span class="sc">';'</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withLineSeparator</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">isEqualsTo</span><span class="o">(</span><span class="s">"/expected/users.csv"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="options-1">Options</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.withHeaders(boolean)</code> ‚Äî treat the first row as a header.</li>
  <li><code class="language-plaintext highlighter-rouge">.withStrictOrder(boolean)</code> ‚Äî require rows to appear in the same order.</li>
  <li><code class="language-plaintext highlighter-rouge">.withColumnSeparator(char)</code> ‚Äî set a custom column separator (default is comma).</li>
  <li><code class="language-plaintext highlighter-rouge">.withLineSeparator(String)</code> ‚Äî set a custom line separator.</li>
</ul>

<h2 id="first-run--debugging-failures">First Run &amp; Debugging Failures</h2>

<ul>
  <li><strong>First run (or if the expected file was deleted)</strong>: Recordo serializes the actual data (object or CSV string) and creates the corresponding JSON/CSV file automatically.</li>
  <li><strong>When a comparison fails</strong>: Recordo writes the actual data into an <code class="language-plaintext highlighter-rouge">ACTUAL/</code> subfolder next to the expected file, using the same file name as in <code class="language-plaintext highlighter-rouge">isEqualTo</code>. For example, <code class="language-plaintext highlighter-rouge">/books/short_books.json</code> will produce <code class="language-plaintext highlighter-rouge">/books/ACTUAL/short_books.json</code>. This allows you to diff expected vs actual in your IDE. The <code class="language-plaintext highlighter-rouge">ACTUAL/</code> folder is only for debugging ‚Äî delete it after review and never commit it to version control.</li>
</ul>

<h2 id="recommended-gitignore-additions">Recommended .gitignore additions</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Recordo temporary outputs
**/ACTUAL/
</code></pre></div></div>

<h1 id="mockmvc-module">MockMvc Module</h1>

<p>This module lets you call Spring MVC controllers via <strong>type‚Äësafe clients</strong> defined as annotated interfaces and executed with Spring <code class="language-plaintext highlighter-rouge">MockMvc</code>.</p>

<p>‚ö†Ô∏è Recordo will work only if there is a <strong>single <code class="language-plaintext highlighter-rouge">MockMvc</code> instance</strong> available in the Spring context.</p>

<h2 id="define-the-client-interface">Define the client interface</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RecordoApiClient</span><span class="o">(</span>
    <span class="n">objectMapper</span> <span class="o">=</span> <span class="s">"customMapper"</span><span class="o">,</span>                                      <span class="c1">// bean name (optional)</span>
    <span class="n">interceptors</span> <span class="o">=</span> <span class="o">{</span> <span class="nc">LocaleInterceptor</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">AuthInterceptor</span><span class="o">.</span><span class="na">class</span> <span class="o">}</span>   <span class="c1">// optional</span>
<span class="o">)</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
<span class="kd">interface</span> <span class="nc">UserApiClient</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
    <span class="nc">UserDto</span> <span class="nf">findById</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="nd">@PostMapping</span>
    <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">)</span>
    <span class="nc">UserDto</span> <span class="nf">create</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">UserDto</span> <span class="n">user</span><span class="o">);</span>

    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
    <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NO_CONTENT</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
    <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">UNAUTHORIZED</span><span class="o">)</span>
    <span class="nc">ErrorDto</span> <span class="nf">getById_withErrors</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span>
                                <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span>
                                <span class="nd">@RequestHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">auth</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>Notes</strong></p>

<ul>
  <li>In <code class="language-plaintext highlighter-rouge">@RecordoApiClient</code> interfaces you use <strong>standard Spring annotations</strong>: <code class="language-plaintext highlighter-rouge">@RequestMapping</code>, <code class="language-plaintext highlighter-rouge">@GetMapping</code>, <code class="language-plaintext highlighter-rouge">@PostMapping</code>, <code class="language-plaintext highlighter-rouge">@DeleteMapping</code>, <code class="language-plaintext highlighter-rouge">@PathVariable</code>, <code class="language-plaintext highlighter-rouge">@RequestParam</code>, <code class="language-plaintext highlighter-rouge">@RequestBody</code>, <code class="language-plaintext highlighter-rouge">@RequestHeader</code>, <code class="language-plaintext highlighter-rouge">@ResponseStatus</code>.</li>
  <li>Recordo executes requests via <code class="language-plaintext highlighter-rouge">MockMvc</code>, automatically verifies the HTTP status, and maps the response body into the declared return type.</li>
  <li>The expected status is declared with <code class="language-plaintext highlighter-rouge">@ResponseStatus</code>. This allows you to write not only positive tests but also <strong>error handling</strong> or <strong>security tests</strong>.</li>
</ul>

<h2 id="create-and-use-the-client">Create and use the client</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebMvcTest</span><span class="o">(</span><span class="nc">UserController</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">RecordoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">UserControllerTest</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserApiClient</span> <span class="n">api</span> <span class="o">=</span> <span class="nc">Recordo</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">UserApiClient</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">shouldCreateAndFetch</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">UserDto</span> <span class="n">created</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="k">new</span> <span class="nc">UserDto</span><span class="o">(</span><span class="s">"John"</span><span class="o">));</span>   <span class="c1">// 201 CREATED (from @ResponseStatus)</span>
        <span class="nc">UserDto</span> <span class="n">loaded</span>  <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">created</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>     <span class="c1">// 200 OK (default)</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="return-types">Return types</h2>

<p>Recordo MockMvc clients support three styles of return values:</p>

<p><strong>Direct result</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Declaration</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
<span class="nc">UserDto</span> <span class="nf">getById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">);</span>

<span class="c1">// Usage</span>
<span class="nc">UserDto</span> <span class="n">user</span> <span class="o">=</span> <span class="n">apiClient</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"Test User"</span><span class="o">);</span>
</code></pre></div></div>

<p><strong>Response wrapper</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Declaration</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
<span class="nc">Response</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="nf">getById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">);</span>

<span class="c1">// Usage</span>
<span class="nc">Response</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">apiClient</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"Test User"</span><span class="o">);</span>
<span class="nc">UserDto</span> <span class="n">userDto</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">();</span>
<span class="nc">HttpStatus</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
</code></pre></div></div>

<p><strong>Request object</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Declaration</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
<span class="nc">Request</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="nf">getById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">);</span>

<span class="c1">// Usage</span>
<span class="nc">Request</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="n">request</span> <span class="o">=</span> <span class="n">apiClient</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"Test User"</span><span class="o">);</span>
<span class="nc">Response</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="s">"Bearer ..."</span><span class="o">).</span><span class="na">perform</span><span class="o">();</span>
</code></pre></div></div>

<h2 id="request-interceptors">Request interceptors</h2>

<p>Declare interceptors in <code class="language-plaintext highlighter-rouge">@RecordoApiClient(interceptors = {...})</code>. Resolution order:</p>

<ol>
  <li>if a Spring bean of that type exists in the context ‚Äî it is used;</li>
  <li>otherwise, the interceptor is <strong>instantiated via default constructor</strong>.</li>
</ol>

<p>Interceptors can mutate outgoing requests (e.g., add headers) before they are executed by <code class="language-plaintext highlighter-rouge">MockMvc</code>.</p>

<p><strong>Example:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthInterceptor</span> <span class="kd">implements</span> <span class="nc">RequestInterceptor</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">SecurityService</span> <span class="n">securityService</span><span class="o">;</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Request</span><span class="o">&lt;?&gt;</span> <span class="n">apply</span><span class="o">(</span><span class="nc">Request</span><span class="o">&lt;?&gt;</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="s">"Bearer "</span> <span class="o">+</span> <span class="n">securityService</span><span class="o">.</span><span class="na">currentToken</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h1 id="mockserver-module">MockServer Module</h1>

<p>Recordo can <strong>record</strong> real HTTP interactions on the first run and <strong>replay</strong> them on subsequent runs. Interactions are persisted as JSON and kept under version control, so your tests remain deterministic.</p>

<h2 id="how-it-works-on-test-runs">How it works on test runs</h2>

<ul>
  <li><strong>First run (or if the file is missing)</strong> ‚Äî real HTTP calls are executed; Recordo captures request/response pairs and writes them to the configured file/folder.</li>
  <li><strong>Subsequent runs</strong> ‚Äî HTTP calls are <strong>not</strong> sent to the network; responses are taken from the saved JSON.</li>
</ul>

<p>This module keeps your integration tests fast, repeatable, and reviewable (recordings are plain JSON files).</p>

<h2 id="setup-with-spring">Setup with Spring</h2>

<h3 id="interceptor-first-integration-primary">Interceptor-first integration (primary)</h3>

<p>Recordo integrates via a <strong>dedicated HTTP interceptor bean</strong> that you attach to your HTTP client. The main idea: <strong>create an interceptor bean and add it to the client</strong>, so that Recordo can intercept requests/responses.</p>

<p>Available interceptors:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ApacheRecordoInterceptor</code></li>
  <li><code class="language-plaintext highlighter-rouge">RestClientRecordoInterceptor</code></li>
  <li><code class="language-plaintext highlighter-rouge">RestTemplateRecordoInterceptor</code></li>
  <li><code class="language-plaintext highlighter-rouge">OkhttpRecordoInterceptor</code></li>
</ul>

<blockquote>
  <p>Make the interceptor a Spring <strong>bean</strong> and wire it into the client you use.</p>
</blockquote>

<p><strong>OkHttp (OkHttpClient)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nc">OkhttpRecordoInterceptor</span> <span class="nf">recordoOkhttpInterceptor</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">OkhttpRecordoInterceptor</span><span class="o">();</span> <span class="o">}</span>

<span class="nd">@Bean</span>
<span class="nc">OkHttpClient</span> <span class="nf">okHttpClient</span><span class="o">(</span><span class="nc">OkhttpRecordoInterceptor</span> <span class="n">interceptor</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">interceptor</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>Apache HttpClient (client5)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nc">ApacheRecordoInterceptor</span> <span class="nf">recordoApacheInterceptor</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">ApacheRecordoInterceptor</span><span class="o">();</span> <span class="o">}</span>

<span class="nd">@Bean</span>
<span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">hc</span><span class="o">.</span><span class="na">client5</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">classic</span><span class="o">.</span><span class="na">HttpClient</span> <span class="nf">apacheHttpClient</span><span class="o">(</span><span class="nc">ApacheRecordoInterceptor</span> <span class="n">interceptor</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">HttpClients</span><span class="o">.</span><span class="na">custom</span><span class="o">()</span>
        <span class="o">.</span><span class="na">addRequestInterceptorFirst</span><span class="o">(</span><span class="n">interceptor</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>Spring RestTemplate</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nc">RestTemplateRecordoInterceptor</span> <span class="nf">recordoRestTemplateInterceptor</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">RestTemplateRecordoInterceptor</span><span class="o">();</span> <span class="o">}</span>

<span class="nd">@Bean</span>
<span class="nc">RestTemplate</span> <span class="nf">restTemplate</span><span class="o">(</span><span class="nc">RestTemplateRecordoInterceptor</span> <span class="n">interceptor</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">restTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RestTemplate</span><span class="o">();</span>
    <span class="n">restTemplate</span><span class="o">.</span><span class="na">getInterceptors</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">interceptor</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">restTemplate</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>Spring RestClient</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nc">RestClientRecordoInterceptor</span> <span class="nf">recordoRestClientInterceptor</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">RestClientRecordoInterceptor</span><span class="o">();</span> <span class="o">}</span>

<span class="nd">@Bean</span>
<span class="nc">RestClient</span> <span class="nf">restClient</span><span class="o">(</span><span class="nc">RestClientRecordoInterceptor</span> <span class="n">interceptor</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">RestClient</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">requestInterceptor</span><span class="o">(</span><span class="n">interceptor</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="auto-wiring-client-bean-alternative">Auto-wiring client bean (alternative)</h3>

<p>As an alternative, Recordo can <strong>search for an HTTP client bean</strong> in the Spring context and automatically attach its interceptor. This requires no explicit interceptor wiring, but works only when there is a <strong>single supported client bean</strong> of that type in the context.</p>

<p>Example with <code class="language-plaintext highlighter-rouge">RestTemplate</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">BookServiceTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">RestTemplate</span> <span class="n">restTemplate</span><span class="o">;</span> <span class="c1">// Recordo will detect and wrap it automatically</span>

    <span class="nd">@Test</span>
    <span class="nd">@MockServer</span><span class="o">(</span><span class="s">"/mock_servers/books.json"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">should_retrieve_books</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="n">bookClient</span><span class="o">.</span><span class="na">getBooks</span><span class="o">();</span>
        <span class="c1">// interactions recorded or replayed automatically</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="using-recordo-without-spring">Using Recordo without Spring</h2>

<p>Recordo can also be used in projects <strong>without Spring</strong>. In this case you annotate the HTTP client or interceptor field with <code class="language-plaintext highlighter-rouge">@EnableRecordo</code>, and Recordo will instrument it directly.</p>

<h3 id="with-explicit-interceptor">With explicit interceptor</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">RecordoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">GitHubServiceTest</span> <span class="o">{</span>

    <span class="nd">@EnableRecordo</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">OkhttpRecordoInterceptor</span> <span class="n">recordoInterceptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkhttpRecordoInterceptor</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">recordoInterceptor</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">GitHubService</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GitHubService</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>

    <span class="nd">@Test</span>
    <span class="nd">@MockServer</span><span class="o">(</span><span class="s">"/mockserver/gists.mock.json"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">test_mock_server</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GistDto</span><span class="o">&gt;</span> <span class="n">gists</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getGists</span><span class="o">();</span>
        <span class="c1">// first run records, next runs replay</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="without-explicit-interceptor">Without explicit interceptor</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">RecordoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">GitHubServiceTest</span> <span class="o">{</span>

    <span class="nd">@EnableRecordo</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">GitHubService</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GitHubService</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>

    <span class="nd">@Test</span>
    <span class="nd">@MockServer</span><span class="o">(</span><span class="s">"/mockserver/gists.mock.json"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">test_mock_server</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GistDto</span><span class="o">&gt;</span> <span class="n">gists</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getGists</span><span class="o">();</span>
        <span class="c1">// first run records, next runs replay</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In both cases, <code class="language-plaintext highlighter-rouge">@EnableRecordo</code> tells Recordo to wrap the client or interceptor so that interactions can be recorded and replayed during tests.</p>

<h2 id="openfeign-via-supported-http-clients">OpenFeign (via supported HTTP clients)</h2>

<p>OpenFeign can be used together with Recordo by wiring it to one of the <strong>supported HTTP clients</strong> (OkHttp or Apache HttpClient). Recordo will attach its interceptors to the underlying client and capture/replay calls.</p>

<p><strong>OkHttp setup</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">okhttp3</span><span class="o">.</span><span class="na">OkHttpClient</span> <span class="nf">okHttpClient</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">okhttp3</span><span class="o">.</span><span class="na">OkHttpClient</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">feign</span><span class="o">.</span><span class="na">Client</span> <span class="nf">feignClient</span><span class="o">(</span><span class="n">okhttp3</span><span class="o">.</span><span class="na">OkHttpClient</span> <span class="n">okHttpClient</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">feign</span><span class="o">.</span><span class="na">okhttp</span><span class="o">.</span><span class="na">OkHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>Apache HttpClient setup</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">hc</span><span class="o">.</span><span class="na">client5</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">classic</span><span class="o">.</span><span class="na">HttpClient</span> <span class="nf">apacheHttpClient</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">feign</span><span class="o">.</span><span class="na">Client</span> <span class="nf">feignClient</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">hc</span><span class="o">.</span><span class="na">client5</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">classic</span><span class="o">.</span><span class="na">HttpClient</span> <span class="n">httpClient</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">feign</span><span class="o">.</span><span class="na">httpclient</span><span class="o">.</span><span class="na">ApacheHttpClient</span><span class="o">(</span><span class="n">httpClient</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>Note: Recordo interacts with Feign <strong>through</strong> the configured OkHttp/Apache client by inserting its interceptors. Make sure these clients are the ones used by Feign in the Spring context.</p>
</blockquote>

<h2 id="annotation-parameters-1">Annotation Parameters</h2>

<p>Use <code class="language-plaintext highlighter-rouge">@MockServer</code> on a test method (or class). Parameters:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">value</code></strong> (String) ‚Äî path to the storage location:
    <ul>
      <li><strong>File path</strong> ending with <code class="language-plaintext highlighter-rouge">.json</code> ‚Üí <em>all interactions</em> are recorded into a <strong>single file</strong>.</li>
      <li><strong>Folder path</strong> (no <code class="language-plaintext highlighter-rouge">.json</code>) ‚Üí each interaction is recorded as a <strong>separate JSON file</strong> inside the folder.</li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">urlPattern</code></strong> (String) ‚Äî optional URL matcher; supports <code class="language-plaintext highlighter-rouge">?</code> (one char), <code class="language-plaintext highlighter-rouge">*</code> (zero or more chars), <code class="language-plaintext highlighter-rouge">**</code> (zero or more path segments).</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">beanName</code></strong> (String) ‚Äî bean name, which can be either the name of the interceptor bean (in interceptor-first mode) or the client bean (in auto-wiring mode).</p>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">objectMapper</code></strong> (String) ‚Äî name of <code class="language-plaintext highlighter-rouge">ObjectMapper</code> bean or test field.</li>
</ul>

<h2 id="examples">Examples</h2>

<h3 id="single-server-file-storage">Single server (file storage)</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="nd">@MockServer</span><span class="o">(</span><span class="s">"/mock_servers/get_gists.json"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">should_retrieve_gists</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GistResponse</span><span class="o">&gt;</span> <span class="n">gists</span> <span class="o">=</span> <span class="n">gitHubClient</span><span class="o">.</span><span class="na">getGists</span><span class="o">();</span>
    <span class="c1">// first run records, next runs replay</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="single-server-folder-storage">Single server (folder storage)</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="nd">@MockServer</span><span class="o">(</span><span class="s">"/mock_servers/gists/"</span><span class="o">)</span> <span class="c1">// folder</span>
<span class="kt">void</span> <span class="nf">should_retrieve_gists_in_folder_mode</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GistResponse</span><span class="o">&gt;</span> <span class="n">gists</span> <span class="o">=</span> <span class="n">gitHubClient</span><span class="o">.</span><span class="na">getGists</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="multiple-http-clients">Multiple HTTP clients</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span> <span class="kd">private</span> <span class="nc">RestTemplate</span> <span class="n">bookServerRestTemplate</span><span class="o">;</span>
<span class="nd">@Autowired</span> <span class="kd">private</span> <span class="nc">RestTemplate</span> <span class="n">authorServerRestTemplate</span><span class="o">;</span>

<span class="nd">@Test</span>
<span class="nd">@MockServer</span><span class="o">(</span><span class="n">httpClient</span> <span class="o">=</span> <span class="s">"bookServerRestTemplate"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"/mockserver/multiservers/books-server.rest.json"</span><span class="o">)</span>
<span class="nd">@MockServer</span><span class="o">(</span><span class="n">httpClient</span> <span class="o">=</span> <span class="s">"authorServerRestTemplate"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"/mockserver/multiservers/authors-server.rest.json"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">should_retrieve_books_and_authors</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// calls using two different clients are recorded into two files</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="multiple-servers-url-pattern">Multiple servers (URL pattern)</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="nd">@MockServer</span><span class="o">(</span><span class="n">beanName</span> <span class="o">=</span> <span class="s">"https://books.server/**"</span><span class="o">,</span>  <span class="n">value</span> <span class="o">=</span> <span class="s">"/mockserver/multiservers/books-server.rest.json"</span><span class="o">)</span>
<span class="nd">@MockServer</span><span class="o">(</span><span class="n">beanName</span> <span class="o">=</span> <span class="s">"https://authors.server/**"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"/mockserver/multiservers/authors-server.rest.json"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">should_retrieve_from_multiple_servers</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// calls to matching hosts go into the respective files</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="license">License</h1>

<p>Recordo is distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>

    </article>
</div>

</main><footer class="site-footer">
    <div class="container footer-inner">
        <p class="copyright">¬© 2025 CARIOCHI.
            Powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">GitHub Pages</a>
        </p>
        <p class="contact">Contact: <a href="mailto:vadym@deineka.com">vadym@deineka.com</a></p>
    </div>
</footer>
<script src="/assets/js/toc.js"></script>
</body>
</html>
